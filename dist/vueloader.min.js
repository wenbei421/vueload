(function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.vueload=e()})(this,function(){var t=1e8;return Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,o=function(){},s=function(){return n.apply(this instanceof o&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,s.prototype=new o,s}),vueload=function(t,e){var n=vueload.parseURL(t);return vueload.load(n.url,e||n.name)},vueload.endWith=function(t,e){var n=new RegExp(e+"$");return n.test(t)},vueload.toAbsUrl=function(t){var e=document.createElement("a");return e.href=t,e.href},vueload.components={},vueload.load=function(t,e){return function(){var n=this.toAbsUrl(t);return this.components[n]?new Promise(function(t,e){t()}).then(function(){var t=this.components[n];return t.name=e,t}.bind(this)):new this.component(e,this).load(t).then(function(t){return t.compile()}).then(function(t){var e=null!==t._script?t._script.module.exports:{};return null!==t._template&&(e.template=t._template.getContent()),void 0===e.name&&void 0!==t.name&&(e.name=t.name),e._baseURI=t.baseURI,t.vueload.components[n]=e,e})}.bind(this)},vueload.require=function(t){var e=vueload.ajax({url:t,async:!1,promise:!1}),n=t.substr(0,t.lastIndexOf("/")+1),o={exports:{}},s=function(t){return vueload.require(vueload.resolveURL(n,t))}.bind(this);try{return Function("exports","require","module",e.responseText).call(o.exports,o.exports,s,o),o.exports}catch(e){console.error("[vueload require compile error("+t+")]: "+e.message+e.stack)}},vueload.extend=function(t,e){for(var n in e)t[n]=e[n];return t},vueload.ajax=function(t){function e(){var t=!1;if(window.XMLHttpRequest)t=new XMLHttpRequest,t.overrideMimeType&&t.overrideMimeType("text/xml");else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiceXObject("Microsoft.XMLHTTP")}catch(e){t=!1}}return t}function n(n){n=vueload.extend({method:"GET",contentType:"text/xml; charset=UTF-8",timeout:0,url:"",async:!0,data:null},t);var o=e();n.timeout>0&&(o.timeout=n.timeout);var s=[];for(var i in n.data)s.push(i+"="+n.data[i]);var r=s.join("&");if("POST"===n.method.toUpperCase())o.open(n.method,n.url,n.async),o.setRequestHeader("Content-Type",n.contentType),o.send(r);else if("GET"===n.method.toUpperCase())return o.open(n.method,n.url+(r?"?"+r:""),n.async),o.send(null),o}return void 0!==t.promise&&null!==t.promise||(t.promise=!0),t.promise?new Promise(function(e,o){try{var s=n(t)}catch(t){o(s,t)}s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status)try{e(s)}catch(t){o(s,t)}else o(s,null)}}.bind(this)):n(t)},vueload.parseURL=function(t){var e,n,o,s;return e=t.split("?"),o=e[0],2==e.length&&(n=e[1]),s=o.substring(o.lastIndexOf("/")+1,o.length),s?this.endWith(s.toLowerCase(),".vue")?s=s.substring(0,s.lastIndexOf(".")):o+=".vue":(s=o.substring(0,o.length-1),s=s.substring(s.lastIndexOf("/")+1,s.length),o+="index.vue"),{name:s,url:o+(n?"?"+n:"")}},vueload.resolveURL=function(t,e){return"./"===e.substr(0,2)?t+e.substr(2):"../"===e.substr(0,3)?t+e.substr(3):e},vueload.register=function(t,e){var n=this.parseURL(e);t.component(n.name,this.load(n.url))},vueload.install=function(t){t.mixin({beforeCreate:function(){var e=this.$options.components;for(var n in e)if("string"==typeof e[n]&&"url:"===e[n].substr(0,4)){var o=vueload.parseURL(e[n].substr(4)),s="_baseURI"in this.$options?this.resolveURL(this.$options._baseURI,o.url):o.url;isNaN(n)?e[n]=vueload.load(s,n):e[n]=t.component(o.name,vueload.load(s,o.name))}}})},vueload.component=function(e,n){this.name=e,this.vueload=n,this._template=null,this._script=null,this._styles=[],this._scopeId="",this.style=function(t,e){this.component=t,this.element=e,this.withBase=function(t){var e;if(this.component.baseURI){e=document.createElement("base"),e.href=this.component.baseURI;var n=this.component.getHead();n.insertBefore(e,n.firstChild)}t.call(this),e&&this.component.getHead().removeChild(e)},this.scopeStyles=function(t,e){function n(){for(var n=t.sheet,o=n.cssRules,s=0;s<o.length;++s){var i=o[s];if(1===i.type){var r=[];i.selectorText.split(/\s*,\s*/).forEach(function(t){r.push(e+" "+t);var n=t.match(/([^ :]+)(.+)?/);r.push(n[1]+e+(n[2]||""))});var a=r.join(",")+i.cssText.substr(i.selectorText.length);n.deleteRule(s),n.insertRule(a,s)}}}try{n()}catch(e){if(e instanceof DOMException&&e.code===DOMException.INVALID_ACCESS_ERR)return t.sheet.disabled=!0,void t.addEventListener("load",function e(){t.removeEventListener("load",e),setTimeout(function(){n(),t.sheet.disabled=!1})});throw e}},this.compile=function(){var t=null!==this.component._template,e=this.element.hasAttribute("scoped");if(e){if(!t)return;this.element.removeAttribute("scoped")}return this.withBase(function(){this.component.getHead().appendChild(this.element)}),e&&this.scopeStyles(this.element,"["+this.component.getScopeId()+"]"),Promise.resolve()},this.getContent=function(){return this.element.textContent},this.setContent=function(t){this.withBase(function(){this.element.textContent=t})}},this.template=function(t,e){this.component=t,this.element=e,this.content=this.component.responseText.match(/<template[\s\S]*?>([\s\S]*?)<\/template>(?![\w\W]*?<\/template>)/)[1],this.getContent=function(){return this.content},this.setContent=function(t){this.content=t},this.addScopeId=function(t){for(var e=0,n=0,o=!1,s="";e<this.content.length;)if("<"==this.content[e]||0!=o){if(o=!0){if(" "==this.content[e]||"\n"==this.content[e]||"\r"==this.content[e]||">"==this.content[e]){n=e,o=!1;break}s+=this.content[e]}e++}else e++;this.content=s+" "+t+this.content.substring(n)},this.compile=function(){return Promise.resolve()}},this.script=function(t,e){this.component=t,this.element=e,this.module={exports:{}},this.getContent=function(){return this.element.textContent},this.setContent=function(t){this.element.textContent=t},this.compile=function(){var t=this.component.url,e=this.component.name,n=function(t){return this.component.vueload.require(this.component.vueload.resolveURL(this.component.baseURI,t))}.bind(this),o=function(t,e){return this.component.vueload(this.component.vueload.resolveURL(this.component.baseURI,t),e)}.bind(this);try{Function("exports","require","vueload","module",this.getContent()).call(this.module.exports,this.module.exports,n,o,this.module)}catch(n){if("lineNumber"in n){var s=this.component.responseText.replace(/\r?\n/g,"\n");s.substr(0,s.indexOf(script)).split("\n").length+n.lineNumber-1;console.error("[vueload component script compile error("+e+":"+t+")]: "+n.message+n.stack)}else console.error("[vueload component script compile error("+e+":"+t+")]: "+n.message+n.stack)}return Promise.resolve(this.module.exports)}},this.getHead=function(){return document.head||document.getElementsByTagName("head")[0]},this.getScopeId=function(){return""===this._scopeId&&(this._scopeId="data-v-"+(t++).toString(36),this._template.addScopeId(this._scopeId)),this._scopeId},this.load=function(t){return this.url=t,this.vueload.ajax({url:t}).then(function(e){this.responseText=e.responseText,this.baseURI=t.substr(0,t.lastIndexOf("/")+1);var n=document.implementation.createHTMLDocument("");n.body.innerHTML=(this.baseURI?'<base href="'+this.baseURI+'">':"")+this.responseText;for(var o=n.body.firstChild;o;o=o.nextSibling)switch(o.nodeName.toUpperCase()){case"TEMPLATE":this._template=new this.template(this,o);break;case"SCRIPT":this._script=new this.script(this,o);break;case"STYLE":this._styles.push(new this.style(this,o))}return this}.bind(this)).catch(function(e){return console.error("[vueload error("+t+")]: "+e.message+e.stack),this}.bind(this))},this.compile=function(){return Promise.all(Array.prototype.concat(this._script&&this._script.compile(),this._styles.map(function(t){return t.compile()}),this._template&&this._template.compile())).then(function(){return this}.bind(this))}},vueload});